<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simon's AI Chat</title>
    <style>
        /* Styles omitted for brevity */
    </style>
</head>
<body>

    <h1>Simon's AI Chat</h1>
    <p>Type your question below to ask the AI!</p>

    <div id="chat-container"></div>

    <!-- Dropdown to select model -->
    <select id="model-selector">
        <option value="llama3.2">Llama 3.2</option>
        <option value="gpt-3.5">GPT-3.5</option>
        <option value="gpt-4">GPT-4</option>
    </select>

    <input type="text" id="user-input" placeholder="Ask the AI..." />
    <button id="send-btn" onclick="askAI()">Ask AI</button>

    <script>
        let conversationHistory = [];  // Store the entire conversation here

        async function askAI() {
            const userInput = document.getElementById('user-input').value;
            if (!userInput) return;  // Don't send empty input

            // Get the selected model from the dropdown
            const selectedModel = document.getElementById('model-selector').value;

            // Add the user's message to the chat history
            conversationHistory.push({ role: 'user', content: userInput });

            const responseDiv = document.getElementById("chat-container");

            // Create and display the user's message bubble
            const userBubble = document.createElement('div');
            userBubble.classList.add('chat-bubble', 'user');
            const userImg = document.createElement('img');
            userImg.src = 'pics/pic1.png';  // User profile picture
            userBubble.appendChild(userImg);
            userBubble.appendChild(document.createTextNode(userInput));
            responseDiv.appendChild(userBubble);

            // Clear the input field
            document.getElementById('user-input').value = '';

            // Scroll to the latest message
            responseDiv.scrollTop = responseDiv.scrollHeight;

            // Add "thinking" bubble with random delay
            const delayBeforeThinking = Math.random() * (2000 - 1000) + 1000;
            const thinkingBubble = document.createElement('div');
            thinkingBubble.classList.add('chat-bubble', 'assistant');
            const assistantImg = document.createElement('img');
            assistantImg.src = 'pics/pic2.png';
            thinkingBubble.appendChild(assistantImg);
            thinkingBubble.textContent = 'AI is thinking...';

            setTimeout(() => {
                responseDiv.appendChild(thinkingBubble);
                responseDiv.scrollTop = responseDiv.scrollHeight;
            }, delayBeforeThinking);

            const url = "http://192.168.1.178:5000/api/chat";  // Proxy server URL
            const data = {
                model: selectedModel,  // Use the selected model
                messages: conversationHistory
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }

                const responseData = await response.json();

                // Remove the "thinking" bubble and display the assistant's response
                thinkingBubble.remove();

                if (responseData.response) {
                    conversationHistory.push({ role: 'assistant', content: responseData.response });
                }

                const assistantBubble = document.createElement('div');
                assistantBubble.classList.add('chat-bubble', 'assistant');
                const assistantImgResponse = document.createElement('img');
                assistantImgResponse.src = 'pics/pic2.png';
                assistantBubble.appendChild(assistantImgResponse);
                assistantBubble.textContent = responseData.response;
                responseDiv.appendChild(assistantBubble);

                // Scroll to the latest message
                responseDiv.scrollTop = responseDiv.scrollHeight;

            } catch (error) {
                console.error('Error fetching the response:', error);
                responseDiv.innerHTML = 'Error occurred while fetching response.';
            }
        }
    </script>

</body>
</html>
